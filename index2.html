<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‚ú® V√≤ng Quay L√¨ X√¨ 2026 ‚ú®</title>

  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Playfair+Display:wght@700&family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#8E0E00;
      --bg2:#1F1C18;
      --primary:#d32f2f;
      --gold:#FFD700;
      --gold2:#B8860B;
      --card:#ffffff;
      --text:#222;
      --muted:#666;
      --shadow: 0 14px 40px rgba(0,0,0,.35);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      color:#fff;
      font-family:'Roboto',system-ui,-apple-system,Segoe UI,Arial,sans-serif;
      background:
        radial-gradient(900px 600px at 20% 10%, rgba(255,215,0,.18), transparent 60%),
        radial-gradient(900px 600px at 80% 15%, rgba(255,235,59,.12), transparent 60%),
        radial-gradient(circle at center, var(--bg1) 0%, var(--bg2) 100%);
      overflow-x:hidden;
      position:relative;
      padding: 22px 14px 44px;
    }

    /* Sparkle grid */
    .sparkle-bg{
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.10;
      background-image: radial-gradient(circle, #ffeb3b 2px, transparent 2.6px);
      background-size: 56px 56px;
      mix-blend-mode: screen;
      z-index:0;
    }

    /* Falling blossoms */
    .falling{
      position:fixed; inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index:1;
    }
    .petal{
      position:absolute;
      width:14px;height:14px;
      border-radius: 50% 0 50% 0;
      opacity:.9;
      animation: fall linear infinite;
      filter: drop-shadow(0 3px 3px rgba(0,0,0,.25));
    }
    @keyframes fall{
      0%{ transform: translate3d(0,-20px,0) rotate(0deg); opacity:1;}
      100%{ transform: translate3d(120px,110vh,0) rotate(360deg); opacity:0;}
    }

    header{
      width:min(860px,100%);
      text-align:center;
      z-index:2;
    }
    h1{
      font-family:'Playfair Display',serif;
      margin: 10px 0 6px;
      font-size: clamp(1.7rem, 3.5vw, 2.35rem);
      text-transform:uppercase;
      color: var(--gold);
      text-shadow: 2px 2px 0px #800000, 0 0 22px rgba(255,215,0,.45);
      line-height:1.25;
    }
    .subtitle{
      font-family:'Dancing Script',cursive;
      font-size: clamp(1.25rem, 3vw, 1.6rem);
      margin: 0 auto 16px;
      color:#fff;
      text-shadow: 0 0 8px rgba(255,0,0,.55);
      opacity:.95;
    }

    .topbar{
      width:min(860px,100%);
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      z-index:2;
      margin-bottom: 10px;
    }
    .pill{
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,215,0,.25);
      border-radius: 999px;
      padding: 10px 14px;
      box-shadow: 0 8px 20px rgba(0,0,0,.20);
      backdrop-filter: blur(8px);
      display:flex;
      gap:10px;
      align-items:center;
      font-weight:800;
    }
    .pill small{ font-weight:700; opacity:.85 }
    .pill b{ color: var(--gold) }

    .layout{
      width:min(860px,100%);
      display:grid;
      grid-template-columns: 1fr 320px;
      gap: 18px;
      align-items:start;
      z-index:2;
      margin-top: 8px;
    }

    .card{
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,215,0,.18);
      border-radius: 22px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      padding: 16px;
    }

    .input-group{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin: 8px 0 10px;
    }
    input{
      padding: 12px 18px;
      width:min(360px,100%);
      border-radius:999px;
      border: 3px solid rgba(255,215,0,.9);
      outline:none;
      background: rgba(255,235,238,.95);
      font-size: 18px;
      font-weight: 900;
      color:#8E0E00;
      box-shadow: 0 10px 22px rgba(0,0,0,.25);
      transition: transform .2s, box-shadow .2s;
      text-align:center;
    }
    input:focus{
      transform: scale(1.03);
      box-shadow: 0 0 26px rgba(255,215,0,.55);
    }

    .wheel-wrap{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 14px;
    }

    .wheel{
      position:relative;
      width: 360px;
      height: 360px;
      border-radius:50%;
      background: #fff;
      border: 10px solid var(--gold2);
      box-shadow: 0 0 14px #fff, 0 0 42px rgba(255,215,0,.55);
      overflow:hidden;
    }
    canvas#wheelCanvas{
      width:100%;
      height:100%;
      border-radius:50%;
      transition: transform 5s cubic-bezier(0.25, 0.1, 0.25, 1);
      will-change: transform;
    }
    .pointer{
      position:absolute;
      top:-34px;
      left:50%;
      transform: translateX(-50%);
      z-index:5;
      filter: drop-shadow(0 6px 6px rgba(0,0,0,.55));
    }
    .pointer::after{
      content:'';
      display:block;
      width:0;height:0;
      border-left: 26px solid transparent;
      border-right: 26px solid transparent;
      border-top: 56px solid #fff;
    }
    .center{
      position:absolute;
      top:50%; left:50%;
      transform: translate(-50%,-50%);
      width: 76px; height: 76px;
      border-radius:50%;
      background: radial-gradient(circle, #fff, var(--gold));
      border: 4px solid #8E0E00;
      box-shadow: 0 0 16px rgba(0,0,0,.5);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 32px;
      z-index:4;
      user-select:none;
    }

    .btn{
      border:none;
      border-radius: 999px;
      padding: 15px 62px;
      font-size: 20px;
      font-weight: 1000;
      letter-spacing:.6px;
      text-transform: uppercase;
      cursor:pointer;
      color:#8E0E00;
      background: linear-gradient(180deg, #FFD700 0%, #FFA500 100%);
      box-shadow: 0 10px 26px rgba(0,0,0,.35), inset 0 2px 6px rgba(255,255,255,.55);
      transition: transform .15s, filter .15s;
    }
    .btn:hover{ filter: brightness(1.03) }
    .btn:active{ transform: scale(.98) }
    .btn:disabled{
      background: #9e9e9e;
      color:#555;
      cursor:not-allowed;
      box-shadow:none;
      filter:none;
      transform:none;
    }

    /* Sidebar */
    .side-title{
      font-family:'Playfair Display',serif;
      margin: 2px 0 10px;
      color: var(--gold);
      text-shadow: 0 0 12px rgba(255,215,0,.35);
      letter-spacing:.4px;
    }
    .hint{
      color: rgba(255,255,255,.9);
      font-size: 13px;
      line-height:1.5;
      margin: 0 0 10px;
    }
    .list{
      display:flex;
      flex-direction:column;
      gap:10px;
      max-height: 360px;
      overflow:auto;
      padding-right: 6px;
    }
    .item{
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(255,215,0,.16);
      border-radius: 16px;
      padding: 10px 12px;
    }
    .item b{ color: var(--gold) }
    .item small{ opacity:.85 }

    /* Modal */
    .modal{
      display:none;
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.86);
      z-index:999;
      justify-content:center;
      align-items:center;
      padding: 18px 12px;
      backdrop-filter: blur(8px);
    }
    .modal-card{
      width:min(460px, 100%);
      background: linear-gradient(135deg, #fff 0%, #fff9c4 100%);
      color: var(--text);
      border-radius: 26px;
      border: 4px solid var(--primary);
      box-shadow: 0 0 55px rgba(255,215,0,.55);
      padding: 26px 18px 18px;
      text-align:center;
      animation: pop .5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position:relative;
    }
    @keyframes pop{
      from{ transform: scale(.6); opacity:0 }
      to{ transform: scale(1); opacity:1 }
    }
    .modal-title{
      font-family:'Playfair Display',serif;
      font-size: 28px;
      color: var(--primary);
      margin: 0 0 8px;
    }
    .amount{
      font-size: 54px;
      color:#d32f2f;
      font-weight: 1000;
      margin: 10px 0 6px;
      text-shadow: 2px 2px 0 rgba(0,0,0,.10);
    }
    .badge{
      display:inline-block;
      background: rgba(211,47,47,.10);
      border: 1px dashed rgba(211,47,47,.55);
      color:#8E0E00;
      padding: 8px 12px;
      border-radius: 999px;
      font-weight: 900;
      margin: 8px 0 10px;
    }
    .msg{
      background:#fff;
      border-radius: 18px;
      border: 2px dashed var(--primary);
      padding: 14px 12px;
      margin: 12px 0;
      box-shadow: inset 0 0 12px rgba(0,0,0,.05);
      line-height:1.55;
      text-align:left;
    }
    .msg strong{ color:#d32f2f }
    .wish{
      font-family:'Dancing Script',cursive;
      font-size: 24px;
      color: var(--gold2);
      font-weight: 900;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #eee;
      text-align:center;
    }
    .cta{
      margin-top: 10px;
      font-size: 13px;
      color:#444;
      opacity:.9;
    }
    .modal-actions{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top: 14px;
    }
    .btn2{
      width:100%;
      border:none;
      border-radius: 14px;
      padding: 12px 14px;
      font-weight: 1000;
      cursor:pointer;
      font-size: 15px;
    }
    .btn-dark{ background:#222; color:#fff }
    .btn-blue{ background:#1976d2; color:#fff }

    /* Confetti canvas */
    #confetti{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:1000;
      display:none;
    }

    /* Responsive */
    @media (max-width: 920px){
      .layout{ grid-template-columns: 1fr; }
      .wheel{ width: 340px; height: 340px; }
    }
    @media (max-width: 380px){
      .wheel{ width: 310px; height: 310px; }
      .btn{ width:100%; padding: 15px 18px; }
      .amount{ font-size: 48px; }
    }
  </style>
</head>

<body>
  <div class="sparkle-bg"></div>
  <div class="falling" id="falling"></div>
  <canvas id="confetti"></canvas>

  <header>
    <h1>üßß V√≤ng Quay <br> Rinh L·ªôc 2026 üßß</h1>
    <div class="subtitle">B·∫°n quay ‚Äî m√¨nh l√¨ x√¨ th·∫≠t üòé‚ú®</div>
  </header>

  <div class="topbar">
    <div class="pill">üéÅ <small>Qu√†:</small> <b id="prizeNote">10k ‚Üí 1 TRI·ªÜU</b></div>
    <div class="pill">üìå <small>C√°ch nh·∫≠n:</small> <b>Ch·ª•p m√†n h√¨nh & g·ª≠i m√¨nh</b></div>
    <div class="pill">üßæ <small>M√£ nh·∫≠n:</small> <b>T·ª± sinh theo l∆∞·ª£t</b></div>
  </div>

  <div class="layout">
    <!-- Main -->
    <div class="card">
      <div class="input-group">
        <input id="username" type="text" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..." autocomplete="off" />
      </div>

      <div class="wheel-wrap">
        <div class="wheel">
          <div class="pointer"></div>
          <canvas id="wheelCanvas" width="500" height="500"></canvas>
          <div class="center">üí∞</div>
        </div>

        <button class="btn" id="spinBtn" onclick="spinWheel()">NH·∫¨N L√å X√å NGAY</button>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="card">
      <div class="side-title">üìú L·ªãch s·ª≠ tr√∫ng th∆∞·ªüng</div>
      <p class="hint">
        M·ªói l∆∞·ª£t quay s·∫Ω l∆∞u l·∫°i tr√™n m√°y b·∫°n (local).<br/>
        Tip: b·∫°n c√≥ th·ªÉ ch·ª•p l·∫°i k·∫øt qu·∫£ + g·ª≠i m√¨nh ƒë·ªÉ nh·∫≠n l√¨ x√¨.
      </p>
      <div class="list" id="historyList"></div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal" id="resultModal">
    <div class="modal-card">
      <div class="modal-title" id="modalTitle">üéâ CH√öC M·ª™NG!! üéâ</div>

      <div class="amount" id="modalAmount">0 ƒë</div>
      <div class="badge">M√£ nh·∫≠n th∆∞·ªüng: <span id="claimCode">XXXX</span></div>

      <div class="msg">
        <div>Xin ch√∫c m·ª´ng <strong id="winnerName"></strong> üéä</div>
        <div>B·∫°n ƒë√£ tr√∫ng l√¨ x√¨ t·ª´ <strong>Th·∫Øng Minh</strong>.</div>
        <div class="cta">üì∏ H√£y <b>ch·ª•p m√†n h√¨nh</b> k·∫øt qu·∫£ n√†y v√† g·ª≠i cho m√¨nh ƒë·ªÉ nh·∫≠n l√¨ x√¨ nh√©.</div>
        <div class="wish" id="randomWishText"></div>
      </div>

      <div class="modal-actions">
        <button class="btn2 btn-blue" onclick="copyClaim()">Copy m√£ nh·∫≠n th∆∞·ªüng</button>
        <button class="btn2 btn-dark" onclick="closeAndReset()">Quay ti·∫øp</button>
      </div>
    </div>
  </div>

  <script>
    // ===== Falling petals =====
    const falling = document.getElementById('falling');
    const colors = ["#FFD700", "#ff9999", "#ffe082", "#ffb3b3"];
    for (let i = 0; i < 34; i++) {
      const p = document.createElement('div');
      p.className = 'petal';
      p.style.left = Math.random()*100 + '%';
      p.style.top = (-20 - Math.random()*300) + 'px';
      p.style.background = colors[Math.floor(Math.random()*colors.length)];
      p.style.animationDuration = (2.6 + Math.random()*3.2) + 's';
      p.style.animationDelay = (Math.random()*4.5) + 's';
      falling.appendChild(p);
    }

    // ===== Wishes (pureÁ•ùÁ¶è) =====
    const tetWishes = [
      "NƒÉm m·ªõi an khang, ti·ªÅn v√¥ nh∆∞ n∆∞·ªõc, c∆∞·ªùi t∆∞∆°i c·∫£ nƒÉm ‚ú®",
      "Ch√∫c b·∫°n 2026 v·∫°n s·ª± nh∆∞ √Ω, l√†m ƒë√¢u th·∫Øng ƒë√≥ üßß",
      "Ch√∫c b·∫°n s·ª©c kh·ªèe d·ªìi d√†o, h·∫°nh ph√∫c ng·∫≠p tr√†n ‚ù§Ô∏è",
      "T·∫•n t√†i t·∫•n l·ªôc t·∫•n b√¨nh an ‚Äî m·ªçi chuy·ªán hanh th√¥ng üéâ",
      "Ch√∫c b·∫°n h·ªçc/ƒëi l√†m ƒë·ªÅu ‚Äúm∆∞·ª£t‚Äù, √≠t stress, nhi·ªÅu ni·ªÅm vui üòå",
      "Ch√∫c b·∫°n g·∫∑p ƒë√∫ng ng∆∞·ªùi, ƒë√∫ng th·ªùi, ƒë√∫ng c∆° h·ªôi ‚Äî b√πng n·ªï lu√¥n üî•",
      "NƒÉm m·ªõi ph√°t t√†i, ph√°t l·ªôc, ph√°t‚Ä¶ th√™m nhi·ªÅu k√®o ngon üòé"
    ];

    // ===== Wheel config =====
    const canvas = document.getElementById('wheelCanvas');
    const ctx = canvas.getContext('2d');
    const spinBtn = document.getElementById('spinBtn');

    const segments = [
      { text:"10k", value:10000,   color:"#ffcdd2", textColor:"#8E0E00" },
      { text:"20k", value:20000,   color:"#ef9a9a", textColor:"#8E0E00" },
      { text:"50k", value:50000,   color:"#e57373", textColor:"#fff" },
      { text:"100k", value:100000, color:"#f44336", textColor:"#fff" },
      { text:"200k", value:200000, color:"#d32f2f", textColor:"#FFD700" },
      { text:"300k", value:300000, color:"#c62828", textColor:"#fff" },
      { text:"500k", value:500000, color:"#b71c1c", textColor:"#FFD700" },
      { text:"1 TRI·ªÜU", value:1000000, color:"#FFD700", textColor:"#8E0E00" }
    ];

    const totalSegments = segments.length;
    const arc = 2*Math.PI/totalSegments;
    let currentRotation = 0;

    function drawWheel(){
      ctx.clearRect(0,0,500,500);
      for(let i=0;i<totalSegments;i++){
        const a = i*arc;

        // slice
        ctx.beginPath();
        ctx.fillStyle = segments[i].color;
        ctx.moveTo(250,250);
        ctx.arc(250,250,250,a,a+arc);
        ctx.closePath();
        ctx.fill();

        // divider
        ctx.strokeStyle = "rgba(255,255,255,.92)";
        ctx.lineWidth = 2;
        ctx.stroke();

        // text
        ctx.save();
        ctx.translate(
          250 + Math.cos(a + arc/2) * 165,
          250 + Math.sin(a + arc/2) * 165
        );
        ctx.rotate(a + arc/2 + Math.PI/2);

        ctx.fillStyle = segments[i].textColor || "#fff";
        ctx.shadowColor = "rgba(0,0,0,.45)";
        ctx.shadowBlur = 4;

        const big = segments[i].value >= 200000;
        ctx.font = big ? "900 28px Arial" : "900 20px Arial";
        const t = segments[i].text;
        ctx.fillText(t, -ctx.measureText(t).width/2, 0);

        ctx.restore();
      }

      // ring highlight
      ctx.save();
      ctx.beginPath();
      ctx.arc(250,250,246,0,2*Math.PI);
      ctx.strokeStyle = "rgba(255,215,0,.35)";
      ctx.lineWidth = 6;
      ctx.stroke();
      ctx.restore();
    }
    drawWheel();

    function formatVND(n){
      return n.toLocaleString('vi-VN') + " ƒë";
    }

    // ===== History =====
    const STORAGE_KEY = "lixi_2026_history_v1";
    function loadHistory(){
      try{ return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); }
      catch{ return []; }
    }
    function saveHistory(list){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list.slice(0,30)));
    }
    function renderHistory(){
      const box = document.getElementById("historyList");
      const list = loadHistory();
      if(list.length === 0){
        box.innerHTML = `<div class="item"><small>Ch∆∞a c√≥ l∆∞·ª£t n√†o. Quay ph√°t cho n√≥ng! üî•</small></div>`;
        return;
      }
      box.innerHTML = list.map(x => `
        <div class="item">
          <div><b>${escapeHtml(x.name)}</b> ‚Äî ${escapeHtml(x.amountText)}</div>
          <small>üßæ ${escapeHtml(x.code)} ‚Ä¢ ‚è± ${escapeHtml(x.time)}</small>
        </div>
      `).join("");
    }
    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }
    renderHistory();

    // ===== Spin =====
    function spinWheel(){
      const nameInput = document.getElementById('username');
      const name = nameInput.value.trim();

      if(!name){
        alert("Nh·∫≠p t√™n v√†o ƒë√£ nha üòÑ");
        nameInput.focus();
        return;
      }

      spinBtn.disabled = true;
      spinBtn.textContent = "ƒêANG QUAY...";

      // Fair random
      const resultIndex = Math.floor(Math.random()*totalSegments);

      const segmentAngle = resultIndex*arc + arc/2;
      const rotateAmount = (360*5) + (270 - (segmentAngle * 180/Math.PI));
      const randomOffset = (Math.floor(Math.random()*18) - 9);
      const finalRotation = currentRotation + rotateAmount + randomOffset;

      currentRotation = finalRotation;
      canvas.style.transform = `rotate(${currentRotation}deg)`;

      setTimeout(()=>{
        showResult(name, segments[resultIndex]);
        spinBtn.disabled = false;
        spinBtn.textContent = "NH·∫¨N L√å X√å NGAY";
      }, 5000);
    }

    function makeClaimCode(name, amount){
      // m√£ ng·∫Øn, d·ªÖ ƒë·ªëi so√°t (kh√¥ng b·∫£o m·∫≠t, ch·ªâ ti·ªán)
      const n = name.trim().toUpperCase().replace(/\s+/g,"").slice(0,4) || "USER";
      const rand = Math.floor(1000 + Math.random()*9000);
      return `LX26-${n}-${amount/1000}K-${rand}`;
    }

    function showResult(name, item){
      const modal = document.getElementById('resultModal');
      const winnerName = document.getElementById('winnerName');
      const modalAmount = document.getElementById('modalAmount');
      const wishBox = document.getElementById('randomWishText');
      const claimCodeEl = document.getElementById('claimCode');
      const modalTitle = document.getElementById('modalTitle');

      const wish = tetWishes[Math.floor(Math.random()*tetWishes.length)];
      const code = makeClaimCode(name, item.value);

      modalTitle.textContent = "üéâ CH√öC M·ª™NG!! üéâ";
      winnerName.textContent = name.toUpperCase();
      modalAmount.textContent = formatVND(item.value);
      wishBox.textContent = `‚Äú${wish}‚Äù`;
      claimCodeEl.textContent = code;

      // save history
      const now = new Date();
      const time = now.toLocaleString('vi-VN', { hour12:false });
      const list = loadHistory();
      list.unshift({ name, amount:item.value, amountText: formatVND(item.value), code, time });
      saveHistory(list);
      renderHistory();

      modal.style.display = "flex";

      popConfetti(1400);
      tinyShake(420);
    }

    function closeAndReset(){
      document.getElementById('resultModal').style.display = "none";
      // ƒë·ªÉ ng∆∞·ªùi ta quay ti·∫øp kh√¥ng c·∫ßn reload
      document.getElementById('username').focus();
    }

    // click outside close
    document.getElementById('resultModal').addEventListener('click', (e)=>{
      if(e.target.id === "resultModal") closeAndReset();
    });

    // ===== Copy claim code =====
    function copyClaim(){
      const code = document.getElementById("claimCode").textContent;
      navigator.clipboard.writeText(code).then(()=>{
        alert("ƒê√£ copy m√£ nh·∫≠n th∆∞·ªüng üßæ");
      }).catch(()=>{
        alert("Kh√¥ng copy ƒë∆∞·ª£c, b·∫°n copy tay gi√∫p m√¨nh nha.");
      });
    }

    // ===== Confetti (no libs) =====
    const confettiCanvas = document.getElementById("confetti");
    const cctx = confettiCanvas.getContext("2d");
    function resizeConfetti(){
      confettiCanvas.width = innerWidth;
      confettiCanvas.height = innerHeight;
    }
    addEventListener("resize", resizeConfetti);
    resizeConfetti();

    function popConfetti(ms=1200){
      confettiCanvas.style.display = "block";
      const W = confettiCanvas.width, H = confettiCanvas.height;
      const pieces = [];
      const count = 170;

      for(let i=0;i<count;i++){
        pieces.push({
          x: Math.random()*W,
          y: -20 - Math.random()*H*0.2,
          r: 2 + Math.random()*4,
          vx: -1.8 + Math.random()*3.6,
          vy: 2.2 + Math.random()*5.2,
          rot: Math.random()*Math.PI,
          vrot: -0.2 + Math.random()*0.4,
          a: 0.9 + Math.random()*0.1
        });
      }

      const start = performance.now();
      const draw = (t)=>{
        const dt = t - start;
        cctx.clearRect(0,0,W,H);

        for(const p of pieces){
          p.x += p.vx;
          p.y += p.vy;
          p.rot += p.vrot;

          cctx.save();
          cctx.translate(p.x, p.y);
          cctx.rotate(p.rot);
          cctx.globalAlpha = p.a;
          cctx.fillRect(-p.r, -p.r, p.r*2.6, p.r*1.2);
          cctx.restore();
        }

        if(dt < ms) requestAnimationFrame(draw);
        else{
          cctx.clearRect(0,0,W,H);
          confettiCanvas.style.display = "none";
        }
      };
      requestAnimationFrame(draw);
    }

    function tinyShake(ms=380){
      const el = document.querySelector(".modal-card");
      if(!el) return;
      const start = performance.now();
      const step = (t)=>{
        const k = Math.max(0, 1 - (t-start)/ms);
        const x = (Math.random()*8-4)*k;
        const y = (Math.random()*8-4)*k;
        el.style.transform = `translate(${x}px,${y}px)`;
        if((t-start) < ms) requestAnimationFrame(step);
        else el.style.transform = "";
      };
      requestAnimationFrame(step);
    }
  </script>
</body>
</html>
